<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARK Signals - Dashboard</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for signal feed */
        .signal-feed::-webkit-scrollbar {
            width: 8px;
        }
        .signal-feed::-webkit-scrollbar-track {
            background: #1f2937; /* gray-800 */
        }
        .signal-feed::-webkit-scrollbar-thumb {
            background: #4b5563; /* gray-600 */
            border-radius: 4px;
        }
        .signal-feed::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* gray-500 */
        }

        /* News Ticker CSS */
        .news-ticker-container {
            width: 100%;
            overflow: hidden;
            background: #111827; /* gray-900 */
            border-bottom: 1px solid #374151; /* gray-700/50 */
            padding: 8px 0;
            white-space: nowrap;
        }

        .news-ticker-content {
            display: inline-block;
            padding-left: 100%;
            animation: marquee 45s linear infinite;
        }

        .news-ticker-content span {
            display: inline-block;
            padding: 0 24px;
            font-size: 0.875rem; /* 14px */
            color: #d1d5db; /* gray-300 */
        }

        .news-ticker-content span strong {
            color: #60a5fa; /* blue-400 */
            font-weight: 600;
        }

        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-100%); }
        }

        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 antialiased flex h-screen">

    <!-- Sidebar Navigation -->
    <aside class="w-64 bg-gray-900 border-r border-gray-700/50 flex flex-col p-4">
        <div class="flex items-center mb-8 shrink-0">
            <!-- Logo -->
            <svg class="h-8 w-8 text-blue-400 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 3.75l4.125 4.125L21.75 3v18H2.25zM12 12.75l-4.125 4.125M12 12.75l4.875-4.875" />
            </svg>
            <span class="font-bold text-xl text-white">ARKSignals</span>
        </div>
        
        <nav class="flex-grow">
            <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mb-2">Markets</h3>
            <!-- 
                NOTE: 
                - We use 'data-market' for filtering.
                - 'nav-link' class is a new common class for JS.
                - We set 'All Signals' to be active by default.
            -->
            <ul class="space-y-1" id="nav-links-container">
                <li>
                    <a href="#" class="nav-link flex items-center px-3 py-2 bg-gray-800 text-white rounded-lg font-medium" data-market="All" data-view="signals">
                        <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 12h16.5m-16.5 3.75h16.5M3.75 19.5h16.5M5.625 4.5h12.75a1.875 1.875 0 010 3.75H5.625a1.875 1.875 0 010-3.75z" /></svg>
                        All Signals
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link flex items-center px-3 py-2 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg font-medium transition-colors" data-market="Indian Stocks" data-view="signals">
                        <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18L9 3.75l4.125 4.125L21.75 3v18H2.25z" /></svg>
                        Indian Stocks
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link flex items-center px-3 py-2 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg font-medium transition-colors" data-market="Crypto" data-view="signals">
                        <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 15.75V18m-7.5-6.75h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        Crypto
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link flex items-center px-3 py-2 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg font-medium transition-colors" data-market="Gold" data-view="signals">
                        <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.419-1.946 4.375-4.375 4.375S11.5 8.794 11.5 6.375s1.946-4.375 4.375-4.375S20.25 3.956 20.25 6.375zM11.5 21v-7.875M3.75 16.125c0 2.419 1.946 4.375 4.375 4.375s4.375-1.956 4.375-4.375S10.546 11.75 8.125 11.75 3.75 13.706 3.75 16.125z" /></svg>
                        Gold
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link flex items-center px-3 py-2 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg font-medium transition-colors" data-market="Currency" data-view="signals">
                        <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                        Currency
                    </a>
                </li>
                <li>
                    <a href="#" class="nav-link flex items-center px-3 py-2 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg font-medium transition-colors" data-market="Crude Oil" data-view="signals">
                        <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048l2.92-2.92a1.125 1.125 0 011.59 0l2.92 2.92c.39.39.39 1.023 0 1.414l-2.92 2.92a1.125 1.125 0 00-1.59 0l-2.92-2.92" /></svg>
                        Crude Oil
                    </a>
                </li>
            </ul>

            <h3 class="text-xs font-semibold text-gray-500 uppercase tracking-wider mt-6 mb-2">Tools</h3>
            <ul class="space-y-1">
                 <li>
                    <a href="#" class="nav-link flex items-center px-3 py-2 text-gray-400 hover:bg-gray-800 hover:text-white rounded-lg font-medium transition-colors" data-view="calculator">
                        <!-- UPDATED ICON: Replaced the old icon with a proper calculator icon -->
                        <svg class="w-5 h-5 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 15.75H15.765M15.75 11.25H15.765M11.25 15.75H11.265M11.25 11.25H11.265M11.25 6.75H11.265M6.75 15.75H6.765M6.75 11.25H6.765M6.75 6.75H6.765M15.75 6.75H15.765M6.75 18H17.25C17.6642 18 18 17.6642 18 17.25V6.75C18 6.33579 17.6642 6 17.25 6H6.75C6.33579 6 6 6.33579 6 6.75V17.25C6 17.6642 6.33579 18 6.75 18Z" />
                        </svg>
                        Calculator
                    </a>
                </li>
            </ul>
        </nav>
        
        <!-- User/Profile Section -->
        <div class="mt-auto pt-4 border-t border-gray-700/50">
            <a href="#" class="flex items-center p-2 rounded-lg hover:bg-gray-800 transition-colors">
                <img class="h-8 w-8 rounded-full object-cover" src="https://placehold.co/100x100/1d4ed8/ffffff?text=R" alt="User avatar">
                <div class="ml-3">
                    <p class="text-sm font-medium text-white">R. Khan</p>
                    <p class="text-xs text-gray-400">View profile</p>
                </div>
                <svg class="w-5 h-5 text-gray-400 ml-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m-3 0l3-3m0 0l-3-3m3 3H5" /></svg>
            </a>
        </div>
    </aside>

    <!-- Main Content Area -->
    <div class="flex-1 flex flex-col overflow-hidden">
        <!-- Main Header -->
        <header class="bg-gray-900 border-b border-gray-700/50 p-4 flex justify-between items-center">
            <h1 class="text-2xl font-bold text-white" id="main-header-title">All Signals</h1>
            
            <!-- Clock and Timezone Selector -->
            <div class="flex items-center space-x-4">
                <select id="timezone-select" class="bg-gray-800 border border-gray-700 text-white text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block p-2">
                    <option value="local">Local Time</option>
                    <option value="UTC">UTC/GMT</option>
                    <option value="America/New_York">New York (EST)</option>
                    <option value="Asia/Kolkata">Kolkata (IST)</option>
                    <option value="Europe/London">London</option>
                </select>
                <div id="clock" class="text-xl font-mono font-semibold text-white">
                    00:00:00
                </div>
            </div>
        </header>

        <!-- News Ticker -->
        <div class="news-ticker-container">
            <div class="news-ticker-content" id="news-ticker-content">
                <!-- News items will be dynamically inserted here -->
            </div>
        </div>

        <!-- Signal Feed -->
        <main class="flex-1 overflow-y-auto p-4 md:p-8 signal-feed bg-gray-900/50">
            <!-- 
                NOTE: This container is now a "view" for the signals.
            -->
            <div id="view-signals">
                <div class="max-w-4xl mx-auto space-y-6" id="signal-feed-container">
                    <!-- Signal cards will be dynamically inserted here -->
                </div>
            </div>

            <!-- 
                NOTE: This is the new "view" for the calculator.
                It's hidden by default.
            -->
            <div id="view-calculator" class="hidden">
                <div class="max-w-4xl mx-auto">
                    <div class="bg-gray-800 rounded-2xl border border-gray-700/50 shadow-lg overflow-hidden">
                        <div class="p-6 md:p-8">
                            <h2 class="text-2xl font-bold text-white mb-1">Trade Calculator</h2>
                            <p class="text-sm text-gray-400 mb-6">Calculate profit/loss, risk/reward, and position value.</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Inputs Column -->
                                <div class="space-y-4">
                                    <div>
                                        <label for="calc-entry" class="block text-sm font-medium text-gray-300">Entry Price</label>
                                        <input type="number" id="calc-entry" class="mt-1 block w-full bg-gray-900 border border-gray-700 rounded-md shadow-sm p-2 text-white focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 60000">
                                    </div>
                                    <div>
                                        <label for="calc-exit" class="block text-sm font-medium text-gray-300">Take Profit (Exit)</label>
                                        <input type="number" id="calc-exit" class="mt-1 block w-full bg-gray-900 border border-gray-700 rounded-md shadow-sm p-2 text-white focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 65000">
                                    </div>
                                    <div>
                                        <label for="calc-sl" class="block text-sm font-medium text-gray-300">Stop Loss</label>
                                        <input type="number" id="calc-sl" class="mt-1 block w-full bg-gray-900 border border-gray-700 rounded-md shadow-sm p-2 text-white focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 58000">
                                    </div>
                                    <div>
                                        <label for="calc-quantity" class="block text-sm font-medium text-gray-300">Quantity / Size</label>
                                        <input type="number" id="calc-quantity" class="mt-1 block w-full bg-gray-900 border border-gray-700 rounded-md shadow-sm p-2 text-white focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 0.5">
                                    </div>
                                    <div>
                                        <label for="calc-fees" class="block text-sm font-medium text-gray-300">Fees (Total %)</label>
                                        <input type="number" id="calc-fees" class="mt-1 block w-full bg-gray-900 border border-gray-700 rounded-md shadow-sm p-2 text-white focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., 0.1" value="0.1">
                                        <p class="text-xs text-gray-500 mt-1">Total percentage for entry and exit (e.g., 0.1% for 0.05% in/out)</p>
                                    </div>
                                    <button id="calculate-trade-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded-lg transition-colors">
                                        Calculate
                                    </button>
                                </div>

                                <!-- Results Column -->
                                <div id="calc-results-container" class="bg-gray-900/50 rounded-lg p-6 border border-gray-700/50 space-y-4">
                                    <!-- Results will be injected here -->
                                    <p class="text-gray-400 text-center py-20">Enter trade details and click "Calculate" to see the results.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </main>
    </div>


    <!-- 
    ================================================================
    == JAVASCRIPT SECTION
    ================================================================
    -->
    <script>
        // --- 1. MOCK DATA ---
        // In a real app, this data would come from a database or API.
        const mockSignals = [
            {
                pair: "BTC / USDT",
                market: "Crypto",
                status: "Active", // Active, TP Hit, SL Hit
                signal: "BUY", // BUY, SELL
                entry: "60,000",
                sl: "58,000",
                tp: "65,000",
                posted: "2 hours ago",
                strategy: "TrendRider V2"
            },
            {
                pair: "BANKNIFTY",
                market: "Indian Stocks",
                status: "Active",
                signal: "SELL",
                entry: "48,500",
                sl: "48,700",
                tp: "48,000",
                posted: "45 minutes ago",
                strategy: "Intraday Scalp"
            },
            {
                pair: "XAU / USD (GOLD)",
                market: "Gold",
                status: "TP Hit",
                signal: "BUY",
                entry: "2300",
                sl: "2290",
                tp: "2320",
                posted: "1 day ago",
                strategy: "Breakout"
            },
            {
                pair: "CRUDE OIL (WTI)",
                market: "Crude Oil",
                status: "SL Hit",
                signal: "SELL",
                entry: "80.00",
                sl: "81.00",
                tp: "78.00",
                posted: "3 days ago",
                strategy: "Mean Reversion"
            },
            {
                pair: "EUR / USD",
                market: "Currency",
                status: "Active",
                signal: "BUY",
                entry: "1.0850",
                sl: "1.0800",
                tp: "1.0950",
                posted: "5 hours ago",
                strategy: "TrendRider V2"
            }
        ];

        // Mock data for the news ticker
        const mockNews = [
            { category: "Crypto", headline: "Bitcoin tests $61,000 resistance level as market sentiment shifts." },
            { category: "Indian Stocks", headline: "NIFTY 50 opens flat, Bank Nifty shows bearish divergence." },
            { category: "Gold", headline: "XAU/USD rallies on weaker-than-expected US inflation data." },
            { category: "Crude Oil", headline: "WTI Crude Oil inventories rise, putting pressure on prices." },
            { category: "Currency", headline: "ECB holds rates steady, EUR/USD remains in tight range." }
        ];

        // --- 2. DOM ELEMENTS ---
        const signalContainer = document.getElementById('signal-feed-container');
        const navLinksContainer = document.getElementById('nav-links-container');
        const mainHeaderTitle = document.getElementById('main-header-title');
        const clockElement = document.getElementById('clock');
        const timezoneSelect = document.getElementById('timezone-select');
        const newsTickerContent = document.getElementById('news-ticker-content');
        
        // --- New View & Calculator Elements ---
        const viewSignals = document.getElementById('view-signals');
        const viewCalculator = document.getElementById('view-calculator');
        const calculateBtn = document.getElementById('calculate-trade-btn');
        const calcResultsContainer = document.getElementById('calc-results-container');
        const calcEntry = document.getElementById('calc-entry');
        const calcExit = document.getElementById('calc-exit');
        const calcSL = document.getElementById('calc-sl');
        const calcQuantity = document.getElementById('calc-quantity');
        const calcFees = document.getElementById('calc-fees');

        let clockInterval; // To store the interval

        // --- 3. CLOCK FUNCTIONALITY ---

        /**
         * Updates the clock element with the current time in the selected timezone.
         */
        function updateClock() {
            const selectedTimezone = timezoneSelect.value;
            let date = new Date();
            let timeString;

            try {
                if (selectedTimezone === 'local') {
                    timeString = date.toLocaleTimeString('en-GB');
                } else {
                    timeString = date.toLocaleTimeString('en-GB', { timeZone: selectedTimezone, hour12: false });
                }
                clockElement.textContent = timeString;
            } catch (error) {
                // Fallback for invalid timezone
                clockElement.textContent = date.toLocaleTimeString('en-GB');
                console.error("Invalid timezone selected:", selectedTimezone);
            }
        }

        /**
         * Starts the clock interval.
         */
        function startClock() {
            // Clear any existing interval
            if (clockInterval) {
                clearInterval(clockInterval);
            }
            // Update the clock immediately
            updateClock();
            // Start a new interval to update it every second
            clockInterval = setInterval(updateClock, 1000);
        }

        // --- 4. NEWS TICKER FUNCTIONALITY ---

        /**
         * Renders the mock news items into the scrolling ticker.
         */
        function renderNewsTicker() {
            let newsHTML = '';
            mockNews.forEach(item => {
                newsHTML += `
                    <span>
                        <strong>${item.category}:</strong> ${item.headline}
                    </span>
                `;
            });
            
            // Duplicate the content to ensure a smooth, endless scroll
            newsTickerContent.innerHTML = newsHTML + newsHTML;
        }

        // --- 5. RENDER SIGNALS FUNCTION ---
        /**
         * Renders a list of signal objects into the DOM.
         * @param {Array} signalsToRender - The array of signal objects to render.
         */
        function renderSignals(signalsToRender) {
            // Clear the existing signals
            signalContainer.innerHTML = '';

            // If no signals, show a message
            if (signalsToRender.length === 0) {
                signalContainer.innerHTML = `<div class="bg-gray-800 rounded-2xl border border-gray-700/50 p-8 text-center">
                    <h3 class="text-xl font-semibold text-white">No signals found</h3>
                    <p class="text-gray-400 mt-2">There are currently no signals for this market.</p>
                </div>`;
                return;
            }

            // Loop through each signal and create an HTML card
            signalsToRender.forEach(signal => {
                // --- Dynamic Class Logic ---
                
                // Status Badge
                let statusClass = '';
                if (signal.status === 'Active') {
                    statusClass = 'bg-green-500/10 text-green-400';
                } else if (signal.status === 'TP Hit') {
                    statusClass = 'bg-blue-500/10 text-blue-400';
                } else if (signal.status === 'SL Hit') {
                    statusClass = 'bg-red-500/10 text-red-400';
                }

                // Signal Type (BUY/SELL)
                let signalClass = signal.signal === 'BUY' ? 'text-green-400' : 'text-red-400';

                // Opacity for closed trades
                let cardOpacity = signal.status === 'Active' ? '' : 'opacity-70';

                // Build the HTML for the card
                const cardHTML = `
                <div class="bg-gray-800 rounded-2xl border border-gray-700/50 shadow-lg overflow-hidden ${cardOpacity}">
                    <div class="p-6">
                        <div class="flex justify-between items-center">
                            <h2 class="text-2xl font-bold text-white">${signal.pair}</h2>
                            <span class="text-sm font-medium ${statusClass} py-1 px-3 rounded-full">${signal.status}</span>
                        </div>
                        <p class="text-sm text-gray-400 mt-1">Market: ${signal.market}</p>
                        
                        <div class="mt-6 grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                            <!-- Signal Type -->
                            <div>
                                <p class="text-xs text-gray-500 uppercase">Signal</p>
                                <p class="text-xl font-semibold ${signalClass}">${signal.signal}</p>
                            </div>
                            <!-- Entry Price -->
                            <div>
                                <p class="text-xs text-gray-500 uppercase">Entry</p>
                                <p class="text-xl font-semibold text-gray-200">${signal.entry}</p>
                            </div>
                            <!-- Stop Loss -->
                            <div>
                                <p class="text-xs text-gray-500 uppercase">Stop Loss</p>
                                <p class="text-xl font-semibold text-red-400">${signal.sl}</p>
                            </div>
                            <!-- Take Profit -->
                            <div>
                                <p class="text-xs text-gray-500 uppercase">Take Profit</p>
                                <p class="text-xl font-semibold text-blue-400">${signal.tp}</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-gray-800 border-t border-gray-700/50 px-6 py-3">
                        <p class="text-xs text-gray-500">Posted: ${signal.posted} ${signal.strategy ? '| Strategy: ' + signal.strategy : ''}</p>
                    </div>
                </div>
                `;
                
                // Add the new card to the container
                signalContainer.innerHTML += cardHTML;
            });
        }

        // --- 6. NEW CALCULATOR FUNCTIONALITY ---
        
        /**
         * Calculates and displays the trade results.
         */
        function calculateTrade() {
            // Get and parse all values as floats
            const entry = parseFloat(calcEntry.value);
            const exit = parseFloat(calcExit.value);
            const sl = parseFloat(calcSL.value);
            const quantity = parseFloat(calcQuantity.value);
            const feesPercent = parseFloat(calcFees.value) || 0;

            // Simple validation
            if (!entry || !exit || !sl || !quantity) {
                calcResultsContainer.innerHTML = `<p class="text-red-400 text-center">Please fill in all price and quantity fields.</p>`;
                return;
            }

            // --- Calculations ---
            const positionValue = entry * quantity;
            const exitValue = exit * quantity;
            
            // Profit / Loss
            const grossPnl = (exit - entry) * quantity;
            const riskAmount = (entry - sl) * quantity; // This will be negative for a long, positive for a short
            const rewardAmount = (exit - entry) * quantity; // This will be positive for a long, negative for a short
            
            const isLong = exit > entry;
            const pnlColor = grossPnl > 0 ? 'text-green-400' : 'text-red-400';
            const rrColor = (rewardAmount / Math.abs(riskAmount)) > 1 ? 'text-green-400' : 'text-red-400';

            // Risk/Reward Ratio
            let rrRatio = 'N/A';
            if (riskAmount !== 0) {
                rrRatio = (Math.abs(rewardAmount / riskAmount)).toFixed(2);
            }

            // Fees
            const entryFee = (positionValue * feesPercent / 100) / 2;
            const exitFee = (exitValue * feesPercent / 100) / 2;
            const totalFees = entryFee + exitFee;

            // Net Profit
            const netPnl = grossPnl - totalFees;
            const netPnlColor = netPnl > 0 ? 'text-green-400' : 'text-red-400';

            // --- Build Result HTML ---
            const resultsHTML = `
                <div class="space-y-3">
                    <div>
                        <p class="text-sm text-gray-400">Position Value</p>
                        <p class="text-xl font-semibold text-white">$${positionValue.toFixed(2)}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400">Risk/Reward Ratio</p>
                        <p class="text-2xl font-bold ${rrColor}">${rrRatio} : 1</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400">Potential Gross Profit/Loss</p>
                        <p class="text-2xl font-bold ${pnlColor}">${grossPnl > 0 ? '+' : ''}${grossPnl.toFixed(2)}</p>
                    </div>
                    <div>
                        <p class="text-sm text-gray-400">Service Charges (Fees)</p>
                        <p class="text-lg font-semibold text-red-400">-${totalFees.toFixed(2)}</p>
                    </div>
                    <div class="pt-2 border-t border-gray-600">
                        <p class="text-sm text-gray-400">Net Profit/Loss</p>
                        <p class="text-3xl font-extrabold ${netPnlColor}">${netPnl > 0 ? '+' : ''}${netPnl.toFixed(2)}</p>
                    </div>
                </div>
            `;

            calcResultsContainer.innerHTML = resultsHTML;
        }


        // --- 7. EVENT LISTENERS ---
        
        // Listen for clicks on the sidebar
        navLinksContainer.addEventListener('click', function(e) {
            // Find the link that was clicked
            const clickedLink = e.target.closest('.nav-link');

            // If we didn't click on a link, do nothing
            if (!clickedLink) return;

            // Stop the link from trying to navigate
            e.preventDefault();

            // --- Handle Active State ---
            // Remove active class from all links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('bg-gray-800', 'text-white');
                link.classList.add('text-gray-400');
            });
            // Add active class to the clicked link
            clickedLink.classList.add('bg-gray-800', 'text-white');
            clickedLink.classList.remove('text-gray-400');

            // --- Handle View & Filter ---
            const viewToShow = clickedLink.dataset.view;
            
            if (viewToShow === 'signals') {
                // --- Handle Filtering ---
                const marketToFilter = clickedLink.dataset.market;
                let filteredSignals;

                if (marketToFilter === 'All') {
                    filteredSignals = mockSignals;
                    mainHeaderTitle.textContent = 'All Signals';
                } else {
                    filteredSignals = mockSignals.filter(signal => signal.market === marketToFilter);
                    mainHeaderTitle.textContent = marketToFilter;
                }
                // Re-render the feed with the filtered signals
                renderSignals(filteredSignals);

                // Show signals, hide calculator
                viewSignals.classList.remove('hidden');
                viewCalculator.classList.add('hidden');
                return; // Added for robust switching
            }
            
            // Changed from 'else if' to 'if' to be more explicit
            if (viewToShow === 'calculator') {
                // Show calculator, hide signals
                viewCalculator.classList.remove('hidden');
                viewSignals.classList.add('hidden');
                mainHeaderTitle.textContent = 'Trade Calculator';
                return; // Added for robust switching
            }
        });

        // Listen for changes on the timezone select
        timezoneSelect.addEventListener('input', startClock);

        // Listen for click on calculate button
        calculateBtn.addEventListener('click', calculateTrade);


        // --- 8. INITIAL RENDER ---
        
        // Load all signals when the page first loads
        renderSignals(mockSignals);

        // Render the news ticker
        renderNewsTicker();
        
        // Start the clock
        startClock();

    </script>
</body>
</html>